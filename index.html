<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Motivo de Contato</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --estoca-blue: #0074d9;
            --estoca-dark-blue: #005fa3;
            --estoca-orange: #ff6600;
            --estoca-bg: #f7f7f7;
            --estoca-white: #fff;
            --estoca-black: #222;
        }
        body {
            font-family: 'Montserrat', Arial, sans-serif;
            background: var(--estoca-bg);
            margin: 0;
            padding: 0;
            color: var(--estoca-black);
        }
        .container {
            max-width: 500px;
            margin: 40px auto;
            background: var(--estoca-white);
            border-radius: 8px;
            box-shadow: 0 2px 8px #0001;
            padding: 32px;
        }
        h2 {
            margin-top: 0;
            color: var(--estoca-blue);
            font-weight: 700;
            font-size: 1.1rem;
            line-height: 1.2;
            letter-spacing: 0.01em;
        }
        ul {
            list-style: none;
            padding: 0;
        }
        li {
            margin-bottom: 12px;
        }
        button {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 4px;
            background: var(--estoca-orange);
            color: var(--estoca-white);
            font-size: 16px;
            font-family: 'Montserrat', Arial, sans-serif;
            cursor: pointer;
            transition: background 0.2s;
            font-weight: 700;
        }
        button:hover {
            background: var(--estoca-blue);
        }
        .msg {
            margin-top: 24px;
            color: var(--estoca-blue);
            font-weight: bold;
        }
        .error {
            color: var(--estoca-orange);
        }
        .escolha {
            color: var(--estoca-orange);
        }
        /* Menu inicial estilo caixa/card */
        .menu-card-grid {
            display: flex;
            flex-direction: column;
            gap: 32px;
            margin-top: 32px;
            align-items: center;
        }
        .menu-card {
            display: flex;
            align-items: center;
            background: var(--estoca-blue);
            color: var(--estoca-white);
            border-radius: 14px;
            box-shadow: 0 4px 24px #0002;
            padding: 12px 14px;
            min-width: 180px;
            max-width: 260px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.18s, box-shadow 0.18s, transform 0.18s;
            margin-bottom: 0;
            border: none;
            outline: none;
        }
        .menu-card:hover {
            background: var(--estoca-dark-blue);
            box-shadow: 0 8px 32px #0074d966;
            transform: translateY(-2px) scale(1.03);
        }
        .menu-card .menu-icon {
            margin-right: 8px;
            width: 22px;
            height: 22px;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .menu-card .action-title {
            flex: 1;
            text-align: left;
            font-size: 0.95rem;
            font-weight: 600;
            line-height: 1.2;
        }
        .action-title {
            display: block;
            font-size: 0.95rem;
            font-weight: 600;
            line-height: 1.2;
        }
        /* Botões simples para motivos e envio */
        .motivo-btn, .enviar-btn {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 4px;
            background: var(--estoca-orange);
            color: var(--estoca-white);
            font-size: 16px;
            font-family: 'Montserrat', Arial, sans-serif;
            cursor: pointer;
            transition: background 0.2s;
            font-weight: 700;
            margin-bottom: 12px;
        }
        .motivo-btn:hover, .enviar-btn:hover {
            background: var(--estoca-blue);
        }
        .action-box {
            background: var(--estoca-blue);
            color: var(--estoca-white);
            border-radius: 8px;
            box-shadow: 0 2px 8px #0002;
            padding: 8px 0;
            width: 100%;
            max-width: 100%;
            text-align: center;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 8px;
            transition: background 0.2s, transform 0.2s;
            border: none;
            outline: none;
            display: block;
        }
        .action-box:hover {
            background: var(--estoca-orange);
            color: var(--estoca-white);
            transform: translateY(-2px) scale(1.02);
        }
        .actions-grid {
            display: flex;
            flex-direction: column;
            gap: 0;
            margin-top: 32px;
            justify-content: center;
        }
    </style>
</head>
<body>
    <div class="container" id="main-container">
        <h2>Qual ação você quer fazer?</h2>
        <div class="menu-card-grid">
            <div class="menu-card" id="acao1">
                <span class="menu-icon"> 
                    <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <rect x="4" y="10" width="24" height="14" rx="3" fill="#fff" fill-opacity="0.18" stroke="#fff" stroke-width="2"/>
                        <rect x="8" y="6" width="16" height="8" rx="2" fill="#fff" fill-opacity="0.32" stroke="#fff" stroke-width="1.5"/>
                    </svg>
                </span>
                <span class="action-title">Falar sobre um chamado já aberto</span>
            </div>
            <div class="menu-card" id="acao2">
                <span class="menu-icon"> 
                    <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <rect x="4" y="10" width="24" height="14" rx="3" fill="#fff" fill-opacity="0.18" stroke="#fff" stroke-width="2"/>
                        <rect x="8" y="6" width="16" height="8" rx="2" fill="#fff" fill-opacity="0.32" stroke="#fff" stroke-width="1.5"/>
                    </svg>
                </span>
                <span class="action-title">Solicitação sobre um pedido de venda</span>
            </div>
            <div class="menu-card" id="acao3">
                <span class="menu-icon"> 
                    <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <rect x="4" y="10" width="24" height="14" rx="3" fill="#fff" fill-opacity="0.18" stroke="#fff" stroke-width="2"/>
                        <rect x="8" y="6" width="16" height="8" rx="2" fill="#fff" fill-opacity="0.32" stroke="#fff" stroke-width="1.5"/>
                    </svg>
                </span>
                <span class="action-title">Demais solicitações</span>
            </div>
        </div>
        <div id="msg" class="msg"></div>
    </div>
    <script>
    // Estilos extras para grid e caixas
    const style = document.createElement('style');
    style.innerHTML = `
        .actions-grid {
            display: flex;
            gap: 24px;
            margin-top: 32px;
            flex-wrap: wrap;
            justify-content: center;
        }
        .action-box {
            background: var(--estoca-blue);
            color: var(--estoca-white);
            border-radius: 8px;
            box-shadow: 0 2px 8px #0002;
            padding: 8px 0;
            width: 100%;
            max-width: 100%;
            text-align: center;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 8px;
            transition: background 0.2s, transform 0.2s;
            border: none;
            outline: none;
            display: block;
        }
        .action-box:hover {
            background: var(--estoca-orange);
            color: var(--estoca-white);
            transform: translateY(-2px) scale(1.02);
        }
        .actions-grid {
            display: flex;
            flex-direction: column;
            gap: 0;
            margin-top: 32px;
            justify-content: center;
        }
        .action-title {
            display: block;
        }
    `;
    document.head.appendChild(style);

    // Captura ticket_id e conversation_id da URL
    const urlParams = new URLSearchParams(window.location.search);
    const ticket_id = urlParams.get('ticket_id') || '';
    const conversation_id = urlParams.get('conversation_id') || '';

    // Verifica se o ticket_id já foi respondido
    const TICKET_KEY = 'eva_ticket_' + ticket_id;
    if (ticket_id && localStorage.getItem(TICKET_KEY) === 'respondido') {
        document.getElementById('main-container').innerHTML = `<h2 style="color:var(--estoca-orange);">Este ticket já foi respondido.<br>Não é possível acessar novamente.</h2>`;
        return;
    }

    // Navegação dos fluxos
    document.getElementById('acao1').onclick = () => abrirFluxo1();
    document.getElementById('acao2').onclick = () => abrirFluxo2();
    document.getElementById('acao3').onclick = () => abrirFluxo3();

    function abrirFluxo1() {
        const container = document.getElementById('main-container');
        container.innerHTML = `
            <h2>Chamado já aberto</h2>
            <form id="form1" class="form-box">
                <label for="ticketid" style="font-size:0.95rem;">TicketID:</label>
                <input type="text" id="ticketid" name="ticketid" required style="width:100%;margin-bottom:10px;padding:7px;border-radius:4px;border:1px solid #ccc;font-size:0.95rem;">
                <label for="solicitacao" style="font-size:0.95rem;">Solicitação:</label>
                <textarea id="solicitacao" name="solicitacao" required style="width:100%;margin-bottom:10px;padding:7px;border-radius:4px;border:1px solid #ccc;font-size:0.95rem;"></textarea>
                <div class="action-box" id="enviar-chamado">Enviar</div>
            </form>
            <div id="msg" class="msg"></div>
        `;
        document.getElementById('enviar-chamado').onclick = async function(e) {
            e.preventDefault();
            const ticketid = document.getElementById('ticketid').value.trim();
            const solicitacao = document.getElementById('solicitacao').value.trim();
    document.addEventListener('DOMContentLoaded', function() {
        // Estilos extras para grid e caixas
        const style = document.createElement('style');
        style.innerHTML = `
            .actions-grid {
                display: flex;
                gap: 24px;
                margin-top: 32px;
                flex-wrap: wrap;
                justify-content: center;
            }
            .action-box {
                background: var(--estoca-blue);
                color: var(--estoca-white);
                border-radius: 8px;
                box-shadow: 0 2px 8px #0002;
                padding: 8px 0;
                width: 100%;
                max-width: 100%;
                text-align: center;
                font-size: 0.9rem;
                font-weight: 600;
                cursor: pointer;
                margin-bottom: 8px;
                transition: background 0.2s, transform 0.2s;
                border: none;
                outline: none;
                display: block;
            }
            .action-box:hover {
                background: var(--estoca-orange);
                color: var(--estoca-white);
                transform: translateY(-2px) scale(1.02);
            }
            .actions-grid {
                display: flex;
                flex-direction: column;
                gap: 0;
                margin-top: 32px;
                justify-content: center;
            }
            .action-title {
                display: block;
            }
        `;
        document.head.appendChild(style);

        // Captura ticket_id e conversation_id da URL
        const urlParams = new URLSearchParams(window.location.search);
        const ticket_id = urlParams.get('ticket_id') || '';
        const conversation_id = urlParams.get('conversation_id') || '';

        // Verifica se o ticket_id já foi respondido
        const TICKET_KEY = 'eva_ticket_' + ticket_id;
        if (ticket_id && localStorage.getItem(TICKET_KEY) === 'respondido') {
            document.getElementById('main-container').innerHTML = `<h2 style="color:var(--estoca-orange);">Este ticket já foi respondido.<br>Não é possível acessar novamente.</h2>`;
            return;
        }

        // Navegação dos fluxos
        document.getElementById('acao1').onclick = () => abrirFluxo1();
        document.getElementById('acao2').onclick = () => abrirFluxo2();
        document.getElementById('acao3').onclick = () => abrirFluxo3();

        function abrirFluxo1() {
            // ...existing code...
        }

        function abrirFluxo2() {
            // ...existing code...
        }

        function abrirFluxo3() {
            // ...existing code...
        }

        // Função para enviar para webhook
        async function enviarWebhook(payload) {
            // ...existing code...
        }
    });
                }
                // Enviar para webhook
                await enviarWebhook({ tipo: 'pedido_venda', orderid, motivo: motivoLabel, motivo_texto: motivoTexto, descricao, ticket_id, conversation_id });
                container.innerHTML = `<h2>Solicitação enviada!</h2><div class="msg">Pedido: ${orderid}<br>Motivo: ${motivoTexto}<br>Descrição: ${descricao}</div>`;
            };
        }
        // Função de validação UUID
        function validarUUID(uuid) {
            return /^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/.test(uuid);
        }
    }

    function abrirFluxo3() {
        // Motivos diversos para demais solicitações
        const motivosDiversos = [
            { texto: 'Contagem de Inventário', label: 'armazenagem__contagem_de_inventário' },
            { texto: 'Disponibilidade de insumos e embalagens', label: 'armazenagem__disponibilidade_de_insumos_e_embalagens' },
            { texto: 'Item avariado no armazém', label: 'armazenagem__item_avariado_no_armazém_' },
            { texto: 'Ruptura/divergência de Estoque', label: 'armazenagem__ruptura/divergência_de_estoque' },
            { texto: 'Solicitação de customização', label: 'armazenagem__solicitação_de_customização' },
            { texto: 'Dúvida sobre cobrança na fatura', label: 'fatura__dúvida_sobre_cobrança_na_fatura' },
            { texto: 'Dúvida sobre ressarcimento', label: 'fatura__dúvida_sobre_ressarcimento' },
            { texto: 'Armazenamento de Inbound atrasado', label: 'inbound__armazenamento_de_inbound_atrasado' },
            { texto: 'Dúvida sobre Criação/Agendamento de Inbound', label: 'inbound__dúvida_sobre_criação/agendamento_de_inbound' },
            { texto: 'Dúvida sobre status do Inbound', label: 'inbound__dúvida_sobre_status_do_inbound' },
            { texto: 'Prioridade no Inbound', label: 'inbound__prioridade_no_inbound' },
            { texto: 'Problema com Inbound', label: 'inbound__problema_com_inbound' },
            { texto: 'Dúvida sobre funcionalidade da Plataforma', label: 'plataforma__dúvida_sobre_funcionalidade_da_plataforma' },
            { texto: 'Erro na Plataforma', label: 'plataforma__erro_na_plataforma' },
            { texto: 'Lentidão na Plataforma', label: 'plataforma__lentidão_na_plataforma' },
            { texto: 'Problemas com Login na Plataforma', label: 'plataforma__problemas_com_login_na_plataforma' },
            { texto: 'Cancelamento de retirada de itens do armazém', label: 'retirada__cancelamento_de_retirada_de_itens_do_armazém' },
            { texto: 'Problema com retirada de itens do armazém', label: 'retirada__problema_com_retirada_de_itens_do_armazém' },
            { texto: 'Solicitação de retirada de itens do armazém', label: 'retirada__solicitação_de_retirada_de_itens_do_armazém' },
            { texto: 'Código de coleta e devolução Mercado Livre', label: 'retirada__código_de_coleta_e_devolução_mercado_livre' },
            { texto: 'Transferência de estoque entre armazéns', label: 'retirada__transferência_de_estoque_entre_armazéns' }
        ].sort((a, b) => a.texto.localeCompare(b.texto));
        const container = document.getElementById('main-container');
        let motivosHtml = '';
        motivosDiversos.forEach(motivo => {
            motivosHtml += `<div class="action-box" data-label="${motivo.label}" style="margin-bottom:10px;font-size:0.95rem;">${motivo.texto}</div>`;
        });
        container.innerHTML = `
            <h2>Motivo da solicitação:</h2>
            <div class="actions-grid" id="motivos-diversos-grid">${motivosHtml}</div>
            <div id="msg" class="msg"></div>
        `;
        // Adiciona evento para cada motivo
        document.querySelectorAll('.action-box[data-label]').forEach(box => {
            box.onclick = () => abrirFormDiversos(box.getAttribute('data-label'), box.textContent);
        });
        // Formulário para demais solicitações
        function abrirFormDiversos(motivoLabel, motivoTexto) {
            container.innerHTML = `
                <h2 style="font-size:1rem;line-height:1.2;">${motivoTexto}</h2>
                <form id="formDiversos" class="form-box">
                    <label for="descricao" style="font-size:0.95rem;">Descrição:</label>
                    <textarea id="descricao" name="descricao" required style="width:100%;margin-bottom:10px;padding:7px;border-radius:4px;border:1px solid #ccc;font-size:0.95rem;"></textarea>
                    <div class="action-box" id="enviar-diversos">Enviar</div>
                </form>
                <div id="msg" class="msg"></div>
            `;
            document.getElementById('enviar-diversos').onclick = async function(e) {
                e.preventDefault();
                const descricao = document.getElementById('descricao').value.trim();
                if (!descricao) {
                    document.getElementById('msg').textContent = 'Preencha a descrição.';
                    document.getElementById('msg').className = 'msg error';
                    return;
                }
                // Enviar para webhook
                await enviarWebhook({ tipo: 'demais_solicitacoes', motivo: motivoLabel, motivo_texto: motivoTexto, descricao, ticket_id, conversation_id });
                container.innerHTML = `<h2>Solicitação enviada!</h2><div class="msg">Motivo: ${motivoTexto}<br>Descrição: ${descricao}</div>`;
            };
            document.getElementById('formDiversos').onsubmit = async function(e) {
                e.preventDefault();
                const descricao = document.getElementById('descricao').value.trim();
                if (!descricao) {
                    document.getElementById('msg').textContent = 'Preencha a descrição.';
                    document.getElementById('msg').className = 'msg error';
                    return;
                }
                // Enviar para webhook
                await enviarWebhook({ tipo: 'demais_solicitacoes', motivo: motivoLabel, motivo_texto: motivoTexto, descricao, ticket_id, conversation_id });
                container.innerHTML = `<h2>Solicitação enviada!</h2><div class="msg">Motivo: ${motivoTexto}<br>Descrição: ${descricao}</div>`;
            };
        }
    }

    // Função para enviar para webhook
    async function enviarWebhook(payload) {
        try {
            await fetch('https://n8n.estoca.com.br/webhook/resposta_eva_v4', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
            if (payload.ticket_id) {
                localStorage.setItem('eva_ticket_' + payload.ticket_id, 'respondido');
            }
        } catch (e) {}
    }
    </script>
</body>
</html>
