<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Motivo de Contato</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --estoca-blue: #0074d9;
            --estoca-dark-blue: #005fa3;
            --estoca-orange: #ff6600;
            --estoca-bg: #f7f7f7;
            --estoca-white: #fff;
            --estoca-black: #222;
        }
        body {
            font-family: 'Montserrat', Arial, sans-serif;
            background: var(--estoca-bg);
            margin: 0;
            padding: 0;
            color: var(--estoca-black);
        }
        .container {
            max-width: 500px;
            margin: 40px auto;
            background: var(--estoca-white);
            border-radius: 8px;
            box-shadow: 0 2px 8px #0001;
            padding: 32px;
        }
        h2 {
            margin-top: 0;
            color: var(--estoca-blue);
            font-weight: 700;
            font-size: 1.1rem;
            line-height: 1.2;
            letter-spacing: 0.01em;
        }
        ul {
            list-style: none;
            padding: 0;
        }
        li {
            margin-bottom: 12px;
        }
        button {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 4px;
            background: var(--estoca-orange);
            color: var(--estoca-white);
            font-size: 16px;
            font-family: 'Montserrat', Arial, sans-serif;
            cursor: pointer;
            transition: background 0.2s;
            font-weight: 700;
        }
        button:hover {
        container.innerHTML = `
            <h2>Motivo do pedido de venda:</h2>
            <form id="formPedido" class="form-box">
                <label for="motivo-pedido" style="font-size:0.95rem;">Motivo:</label>
                <input type="text" id="motivo-pedido" name="motivo-pedido" autocomplete="off" required style="width:100%;margin-bottom:8px;padding:7px;border-radius:4px;border:1px solid #ccc;font-size:0.95rem;" placeholder="Digite para buscar...">
                <ul id="motivo-pedido-list" style="list-style:none;padding:0;margin:0;max-height:180px;overflow-y:auto;border:1px solid #eee;border-radius:4px;background:#fff;position:absolute;z-index:10;width:calc(100% - 2px);display:none;"></ul>
                <label for="orderid" style="font-size:0.95rem;">Pedido (UUID):</label>
                <input type="text" id="orderid" name="orderid" required style="width:100%;margin-bottom:8px;padding:7px;border-radius:4px;border:1px solid #ccc;font-size:0.95rem;">
                <div id="uuid-alert" class="error" style="display:none;margin-bottom:8px;font-size:0.95rem;"></div>
                <label for="descricao" style="font-size:0.95rem;">Descrição:</label>
                <textarea id="descricao" name="descricao" required style="width:100%;margin-bottom:10px;padding:7px;border-radius:4px;border:1px solid #ccc;font-size:0.95rem;"></textarea>
                <div class="action-box" id="enviar-pedido">Enviar</div>
            </form>
            <div id="msg" class="msg"></div>
        `;
        // Autocomplete motivos
        const motivoInput = document.getElementById('motivo-pedido');
        const motivoList = document.getElementById('motivo-pedido-list');
        let motivoSelecionado = null;
        motivoInput.addEventListener('input', function() {
            const val = motivoInput.value.toLowerCase();
            motivoList.innerHTML = '';
            if (!val) {
                motivoList.style.display = 'none';
                motivoSelecionado = null;
                return;
            }
            const filtrados = motivosPedido.filter(m => m.texto.toLowerCase().includes(val));
            filtrados.forEach(motivo => {
                const li = document.createElement('li');
                li.textContent = motivo.texto;
                li.style.padding = '8px';
                li.style.cursor = 'pointer';
                li.onmousedown = function(e) {
                    motivoInput.value = motivo.texto;
                    motivoSelecionado = motivo;
                    motivoList.style.display = 'none';
                };
                motivoList.appendChild(li);
            });
            motivoList.style.display = filtrados.length ? 'block' : 'none';
        });
        motivoInput.addEventListener('focus', function() {
            if (motivoInput.value) motivoInput.dispatchEvent(new Event('input'));
        });
        document.addEventListener('click', function(e) {
            if (!motivoInput.contains(e.target) && !motivoList.contains(e.target)) {
                motivoList.style.display = 'none';
            }
        });
        // Validação UUID em tempo real
        const uuidInput = document.getElementById('orderid');
        const uuidAlert = document.getElementById('uuid-alert');
        uuidInput.addEventListener('input', function() {
            if (!validarUUID(uuidInput.value)) {
                uuidAlert.textContent = 'ID do pedido inválido. Deve ser um UUID (36 caracteres, formato XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX).';
                uuidAlert.style.display = 'block';
            } else {
                uuidAlert.textContent = '';
                uuidAlert.style.display = 'none';
            }
        });
        document.getElementById('enviar-pedido').onclick = async function(e) {
            e.preventDefault();
            const orderid = uuidInput.value.trim();
            const descricao = document.getElementById('descricao').value.trim();
            const motivo = motivoSelecionado || motivosPedido.find(m => m.texto === motivoInput.value.trim());
            if (!motivo) {
                document.getElementById('msg').textContent = 'Selecione um motivo válido.';
                document.getElementById('msg').className = 'msg error';
                return;
            }
            if (!validarUUID(orderid)) {
                uuidAlert.textContent = 'ID do pedido inválido. Deve ser um UUID.';
                uuidAlert.style.display = 'block';
                return;
            }
            if (!descricao) {
                document.getElementById('msg').textContent = 'Preencha a descrição.';
                document.getElementById('msg').className = 'msg error';
                return;
            }
            // Enviar para webhook
            await enviarWebhook({ tipo: 'pedido_venda', orderid, motivo: motivo.label, motivo_texto: motivo.texto, descricao, ticket_id, conversation_id });
            container.innerHTML = `<h2>Solicitação enviada!</h2><div class="msg">Pedido: ${orderid}<br>Motivo: ${motivo.texto}<br>Descrição: ${descricao}</div>`;
        };
        document.getElementById('formPedido').onsubmit = async function(e) {
            e.preventDefault();
            document.getElementById('enviar-pedido').click();
        };
        function validarUUID(uuid) {
            return /^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/.test(uuid);
        }
        }
        .motivo-btn:hover, .enviar-btn:hover {
            background: var(--estoca-blue);
        }
        .action-box {
            background: var(--estoca-blue);
            color: var(--estoca-white);
            border-radius: 8px;
            box-shadow: 0 2px 8px #0002;
            padding: 8px 0;
            width: 100%;
            max-width: 100%;
            text-align: center;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 8px;
            transition: background 0.2s, transform 0.2s;
            border: none;
            outline: none;
            display: block;
        }
        .action-box:hover {
            background: var(--estoca-orange);
            color: var(--estoca-white);
            transform: translateY(-2px) scale(1.02);
        }
        .actions-grid {
            display: flex;
            flex-direction: column;
            gap: 0;
            margin-top: 32px;
            justify-content: center;
        }
    </style>
</head>
<body>
    <div class="container" id="main-container">
        <h2>Qual ação você quer fazer?</h2>
        <div class="menu-card-grid">
            <div class="menu-card" id="acao1">
                <span class="menu-icon"> 
                    <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <rect x="4" y="10" width="24" height="14" rx="3" fill="#fff" fill-opacity="0.18" stroke="#fff" stroke-width="2"/>
                        <rect x="8" y="6" width="16" height="8" rx="2" fill="#fff" fill-opacity="0.32" stroke="#fff" stroke-width="1.5"/>
                    </svg>
                </span>
                <span class="action-title">Falar sobre um chamado já aberto</span>
            </div>
            <div class="menu-card" id="acao2">
                <span class="menu-icon"> 
                    <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <rect x="4" y="10" width="24" height="14" rx="3" fill="#fff" fill-opacity="0.18" stroke="#fff" stroke-width="2"/>
                        <rect x="8" y="6" width="16" height="8" rx="2" fill="#fff" fill-opacity="0.32" stroke="#fff" stroke-width="1.5"/>
                    </svg>
                </span>
                <span class="action-title">Solicitação sobre um pedido de venda</span>
            </div>
            <div class="menu-card" id="acao3">
                <span class="menu-icon"> 
                    <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <rect x="4" y="10" width="24" height="14" rx="3" fill="#fff" fill-opacity="0.18" stroke="#fff" stroke-width="2"/>
                        <rect x="8" y="6" width="16" height="8" rx="2" fill="#fff" fill-opacity="0.32" stroke="#fff" stroke-width="1.5"/>
                    </svg>
                </span>
                <span class="action-title">Demais solicitações</span>
            </div>
        </div>
        <div id="msg" class="msg"></div>
    </div>
    <script>
    // Estilos extras para grid e caixas
    const style = document.createElement('style');
    style.innerHTML = `
        .actions-grid {
            display: flex;
            gap: 24px;
            margin-top: 32px;
            flex-wrap: wrap;
            justify-content: center;
        }
        .action-box {
            background: var(--estoca-blue);
            color: var(--estoca-white);
            border-radius: 8px;
            box-shadow: 0 2px 8px #0002;
            padding: 8px 0;
            width: 100%;
            max-width: 100%;
            text-align: center;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 8px;
            transition: background 0.2s, transform 0.2s;
            border: none;
            outline: none;
            display: block;
        }
        .action-box:hover {
            background: var(--estoca-orange);
            color: var(--estoca-white);
            transform: translateY(-2px) scale(1.02);
        }
        .actions-grid {
            display: flex;
            flex-direction: column;
            gap: 0;
            margin-top: 32px;
            justify-content: center;
        }
        .action-title {
            display: block;
        }
    `;
    document.head.appendChild(style);

    // Captura ticket_id e conversation_id da URL
    const urlParams = new URLSearchParams(window.location.search);
    const ticket_id = urlParams.get('ticket_id') || '';
    const conversation_id = urlParams.get('conversation_id') || '';

    // Verifica se o ticket_id já foi respondido
    const TICKET_KEY = 'eva_ticket_' + ticket_id;
    if (ticket_id && localStorage.getItem(TICKET_KEY) === 'respondido') {
        document.getElementById('main-container').innerHTML = `<h2 style="color:var(--estoca-orange);">Este ticket já foi respondido.<br>Não é possível acessar novamente.</h2>`;
        return;
    }

    // Navegação dos fluxos
    document.getElementById('acao1').onclick = () => abrirFluxo1();
    document.getElementById('acao2').onclick = () => abrirFluxo2();
    document.getElementById('acao3').onclick = () => abrirFluxo3();

    function abrirFluxo1() {
        const container = document.getElementById('main-container');
        container.innerHTML = `
            <h2>Chamado já aberto</h2>
            <form id="form1" class="form-box">
                <label for="ticketid" style="font-size:0.95rem;">TicketID:</label>
                <input type="text" id="ticketid" name="ticketid" required style="width:100%;margin-bottom:10px;padding:7px;border-radius:4px;border:1px solid #ccc;font-size:0.95rem;">
                <label for="solicitacao" style="font-size:0.95rem;">Solicitação:</label>
                <textarea id="solicitacao" name="solicitacao" required style="width:100%;margin-bottom:10px;padding:7px;border-radius:4px;border:1px solid #ccc;font-size:0.95rem;"></textarea>
                <div class="action-box" id="enviar-chamado">Enviar</div>
            </form>
            <div id="msg" class="msg"></div>
        `;
        document.getElementById('enviar-chamado').onclick = async function(e) {
            e.preventDefault();
            const ticketid = document.getElementById('ticketid').value.trim();
            const solicitacao = document.getElementById('solicitacao').value.trim();
    document.addEventListener('DOMContentLoaded', function() {
    document.addEventListener('DOMContentLoaded', function() {
        // Estilos extras para grid e caixas
        const style = document.createElement('style');
        style.innerHTML = `
            .actions-grid {
                display: flex;
                gap: 24px;
                margin-top: 32px;
                flex-wrap: wrap;
                justify-content: center;
            }
            .action-box {
                background: var(--estoca-blue);
                color: var(--estoca-white);
                border-radius: 8px;
                box-shadow: 0 2px 8px #0002;
                padding: 8px 0;
                width: 100%;
                max-width: 100%;
                text-align: center;
                font-size: 0.9rem;
                font-weight: 600;
                cursor: pointer;
                margin-bottom: 8px;
                transition: background 0.2s, transform 0.2s;
                border: none;
                outline: none;
                display: block;
            }
            .action-box:hover {
                background: var(--estoca-orange);
                color: var(--estoca-white);
                transform: translateY(-2px) scale(1.02);
            }
            .actions-grid {
                display: flex;
                flex-direction: column;
                gap: 0;
                margin-top: 32px;
                justify-content: center;
            }
            .action-title {
                display: block;
            }
        `;
        document.head.appendChild(style);

        // Captura ticket_id e conversation_id da URL
        const urlParams = new URLSearchParams(window.location.search);
        const ticket_id = urlParams.get('ticket_id') || '';
        const conversation_id = urlParams.get('conversation_id') || '';

        // Verifica se o ticket_id já foi respondido
        const TICKET_KEY = 'eva_ticket_' + ticket_id;
        if (ticket_id && localStorage.getItem(TICKET_KEY) === 'respondido') {
            document.getElementById('main-container').innerHTML = `<h2 style="color:var(--estoca-orange);">Este ticket já foi respondido.<br>Não é possível acessar novamente.</h2>`;
            return;
        }

        // Navegação dos fluxos
        document.getElementById('acao1').onclick = () => abrirFluxo1();
        document.getElementById('acao2').onclick = () => abrirFluxo2();
        document.getElementById('acao3').onclick = () => abrirFluxo3();

        function abrirFluxo1() {
            // ...existing code...
        }

        function abrirFluxo2() {
            // ...existing code...
        }

        function abrirFluxo3() {
            // ...existing code...
        }

        // Função para enviar para webhook
        async function enviarWebhook(payload) {
            // ...existing code...
        }
    });
    });
                }
                // Enviar para webhook
                await enviarWebhook({ tipo: 'pedido_venda', orderid, motivo: motivoLabel, motivo_texto: motivoTexto, descricao, ticket_id, conversation_id });
                container.innerHTML = `<h2>Solicitação enviada!</h2><div class="msg">Pedido: ${orderid}<br>Motivo: ${motivoTexto}<br>Descrição: ${descricao}</div>`;
            };
        }
        // Função de validação UUID
        function validarUUID(uuid) {
            return /^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/.test(uuid);
        }
    }

    function abrirFluxo3() {
        // Motivos diversos para demais solicitações
        const motivosDiversos = [
            { texto: 'Contagem de Inventário', label: 'armazenagem__contagem_de_inventário' },
            { texto: 'Disponibilidade de insumos e embalagens', label: 'armazenagem__disponibilidade_de_insumos_e_embalagens' },
            { texto: 'Item avariado no armazém', label: 'armazenagem__item_avariado_no_armazém_' },
            { texto: 'Ruptura/divergência de Estoque', label: 'armazenagem__ruptura/divergência_de_estoque' },
            { texto: 'Solicitação de customização', label: 'armazenagem__solicitação_de_customização' },
            { texto: 'Dúvida sobre cobrança na fatura', label: 'fatura__dúvida_sobre_cobrança_na_fatura' },
            { texto: 'Dúvida sobre ressarcimento', label: 'fatura__dúvida_sobre_ressarcimento' },
            { texto: 'Armazenamento de Inbound atrasado', label: 'inbound__armazenamento_de_inbound_atrasado' },
            { texto: 'Dúvida sobre Criação/Agendamento de Inbound', label: 'inbound__dúvida_sobre_criação/agendamento_de_inbound' },
            { texto: 'Dúvida sobre status do Inbound', label: 'inbound__dúvida_sobre_status_do_inbound' },
            { texto: 'Prioridade no Inbound', label: 'inbound__prioridade_no_inbound' },
            { texto: 'Problema com Inbound', label: 'inbound__problema_com_inbound' },
            { texto: 'Dúvida sobre funcionalidade da Plataforma', label: 'plataforma__dúvida_sobre_funcionalidade_da_plataforma' },
            { texto: 'Erro na Plataforma', label: 'plataforma__erro_na_plataforma' },
            { texto: 'Lentidão na Plataforma', label: 'plataforma__lentidão_na_plataforma' },
            { texto: 'Problemas com Login na Plataforma', label: 'plataforma__problemas_com_login_na_plataforma' },
            { texto: 'Cancelamento de retirada de itens do armazém', label: 'retirada__cancelamento_de_retirada_de_itens_do_armazém' },
            { texto: 'Problema com retirada de itens do armazém', label: 'retirada__problema_com_retirada_de_itens_do_armazém' },
            { texto: 'Solicitação de retirada de itens do armazém', label: 'retirada__solicitação_de_retirada_de_itens_do_armazém' },
            { texto: 'Código de coleta e devolução Mercado Livre', label: 'retirada__código_de_coleta_e_devolução_mercado_livre' },
            { texto: 'Transferência de estoque entre armazéns', label: 'retirada__transferência_de_estoque_entre_armazéns' }
        ].sort((a, b) => a.texto.localeCompare(b.texto));
        const container = document.getElementById('main-container');
        container.innerHTML = `
            <h2>Motivo da solicitação:</h2>
            <form id="formDiversos" class="form-box">
                <label for="motivo-diverso" style="font-size:0.95rem;">Motivo:</label>
                <input type="text" id="motivo-diverso" name="motivo-diverso" autocomplete="off" required style="width:100%;margin-bottom:8px;padding:7px;border-radius:4px;border:1px solid #ccc;font-size:0.95rem;" placeholder="Digite para buscar...">
                <ul id="motivo-diverso-list" style="list-style:none;padding:0;margin:0;max-height:180px;overflow-y:auto;border:1px solid #eee;border-radius:4px;background:#fff;position:absolute;z-index:10;width:calc(100% - 2px);display:none;"></ul>
                <label for="descricao" style="font-size:0.95rem;">Descrição:</label>
                <textarea id="descricao" name="descricao" required style="width:100%;margin-bottom:10px;padding:7px;border-radius:4px;border:1px solid #ccc;font-size:0.95rem;"></textarea>
                <div class="action-box" id="enviar-diversos">Enviar</div>
            </form>
            <div id="msg" class="msg"></div>
        `;
        // Autocomplete motivos
        const motivoInput = document.getElementById('motivo-diverso');
        const motivoList = document.getElementById('motivo-diverso-list');
        let motivoSelecionado = null;
        motivoInput.addEventListener('input', function() {
            const val = motivoInput.value.toLowerCase();
            motivoList.innerHTML = '';
            if (!val) {
                motivoList.style.display = 'none';
                motivoSelecionado = null;
                return;
            }
            const filtrados = motivosDiversos.filter(m => m.texto.toLowerCase().includes(val));
            filtrados.forEach(motivo => {
                const li = document.createElement('li');
                li.textContent = motivo.texto;
                li.style.padding = '8px';
                li.style.cursor = 'pointer';
                li.onmousedown = function(e) {
                    motivoInput.value = motivo.texto;
                    motivoSelecionado = motivo;
                    motivoList.style.display = 'none';
                };
                motivoList.appendChild(li);
            });
            motivoList.style.display = filtrados.length ? 'block' : 'none';
        });
        motivoInput.addEventListener('focus', function() {
            if (motivoInput.value) motivoInput.dispatchEvent(new Event('input'));
        });
        document.addEventListener('click', function(e) {
            if (!motivoInput.contains(e.target) && !motivoList.contains(e.target)) {
                motivoList.style.display = 'none';
            }
        });
        document.getElementById('enviar-diversos').onclick = async function(e) {
            e.preventDefault();
            const descricao = document.getElementById('descricao').value.trim();
            const motivo = motivoSelecionado || motivosDiversos.find(m => m.texto === motivoInput.value.trim());
            if (!motivo) {
                document.getElementById('msg').textContent = 'Selecione um motivo válido.';
                document.getElementById('msg').className = 'msg error';
                return;
            }
            if (!descricao) {
                document.getElementById('msg').textContent = 'Preencha a descrição.';
                document.getElementById('msg').className = 'msg error';
                return;
            }
            // Enviar para webhook
            await enviarWebhook({ tipo: 'demais_solicitacoes', motivo: motivo.label, motivo_texto: motivo.texto, descricao, ticket_id, conversation_id });
            container.innerHTML = `<h2>Solicitação enviada!</h2><div class="msg">Motivo: ${motivo.texto}<br>Descrição: ${descricao}</div>`;
        };
        document.getElementById('formDiversos').onsubmit = async function(e) {
            e.preventDefault();
            document.getElementById('enviar-diversos').click();
        };
    }

    // Função para enviar para webhook
    async function enviarWebhook(payload) {
        try {
            await fetch('https://n8n.estoca.com.br/webhook/resposta_eva_v4', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
            if (payload.ticket_id) {
                localStorage.setItem('eva_ticket_' + payload.ticket_id, 'respondido');
            }
        } catch (e) {}
    }
    </script>
</body>
</html>
